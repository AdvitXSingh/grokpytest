<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Ball Bouncing in Spinning Hexagon</title>
                <style>
                        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: black; }
                                canvas { border: 1px solid white; }
                                    </style>
                                    </head>
                                    <body>
                                        <canvas id="canvas" width="400" height="400"></canvas>
                                            <script>
                                                    const canvas = document.getElementById('canvas');
                                                            const ctx = canvas.getContext('2d');
                                                                    const CX = 200, CY = 200;  // Center of the hexagon
                                                                            const R_HEXAGON = 150;     // Radius of the hexagon
                                                                                    const BALL_R = 10;         // Radius of the ball
                                                                                            const G = 980;             // Gravity (pixels/s^2)
                                                                                                    const E = 0.8;             // Coefficient of restitution (0 to 1)
                                                                                                            const OMEGA = 0.5;         // Angular velocity of hexagon (radians/s)
                                                                                                                    const FPS = 60;

                                                                                                                            let ballX = CX, ballY = CY - 100;  // Initial ball position
                                                                                                                                    let vx = 0, vy = 0;                // Initial velocity
                                                                                                                                            let theta = 0;                     // Initial rotation angle of hexagon
                                                                                                                                                    let lastTime = performance.now();

                                                                                                                                                            function drawHexagon() {
                                                                                                                                                                        ctx.beginPath();
                                                                                                                                                                                    for (let k = 0; k < 6; k++) {
                                                                                                                                                                                                    const angle = k * Math.PI / 3 + theta;
                                                                                                                                                                                                                    const x = CX + R_HEXAGON * Math.cos(angle);
                                                                                                                                                                                                                                    const y = CY + R_HEXAGON * Math.sin(angle);
                                                                                                                                                                                                                                                    if (k === 0) ctx.moveTo(x, y);
                                                                                                                                                                                                                                                                    else ctx.lineTo(x, y);
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                            ctx.closePath();
                                                                                                                                                                                                                                                                                                        ctx.strokeStyle = 'white';
                                                                                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                    function drawBall() {
                                                                                                                                                                                                                                                                                                                                                ctx.beginPath();
                                                                                                                                                                                                                                                                                                                                                            ctx.arc(ballX, ballY, BALL_R, 0, 2 * Math.PI);
                                                                                                                                                                                                                                                                                                                                                                        ctx.fillStyle = 'red';
                                                                                                                                                                                                                                                                                                                                                                                    ctx.fill();
                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                    function update(dt) {
                                                                                                                                                                                                                                                                                                                                                                                                                // Update hexagon rotation
                                                                                                                                                                                                                                                                                                                                                                                                                            theta += OMEGA * dt;

                                                                                                                                                                                                                                                                                                                                                                                                                                        // Apply gravity to ball velocity
                                                                                                                                                                                                                                                                                                                                                                                                                                                    vy += G * dt;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Update ball position
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ballX += vx * dt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ballY += vy * dt;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Collision detection with hexagon edges
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for (let k = 0; k < 6; k++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const angle1 = k * Math.PI / 3 + theta;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const angle2 = (k + 1) * Math.PI / 3 + theta;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const P0 = [CX + R_HEXAGON * Math.cos(angle1), CY + R_HEXAGON * Math.sin(angle1)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const P1 = [CX + R_HEXAGON * Math.cos(angle2), CY + R_HEXAGON * Math.sin(angle2)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const D = [P1[0] - P0[0], P1[1] - P0[1]];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const N = [D[1], -D[0]];  // Inward normal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const mag = Math.sqrt(N[0] ** 2 + N[1] ** 2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const N_unit = [N[0] / mag, N[1] / mag];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const d = (ballX - P0[0]) * N_unit[0] + (ballY - P0[1]) * N_unit[1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (d < BALL_R) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Collision detected: reflect velocity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const dot = vx * N_unit[0] + vy * N_unit[1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            vx -= (1 + E) * dot * N_unit[0];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                vy -= (1 + E) * dot * N_unit[1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Adjust position to avoid sticking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const overlap = BALL_R - d;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ballX += overlap * N_unit[0];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ballY += overlap * N_unit[1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function animate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const now = performance.now();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const dt = (now - lastTime) / 1000;  // Time step in seconds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                lastTime = now;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Clear canvas
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Update and draw
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                update(dt);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            drawHexagon();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        drawBall();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    requestAnimationFrame(animate);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Start the animation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            animate();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </html>